<!DOCTYPE html>
<html>
<head>
	<title>Radunfälle Gütersloh 2015</title>
	<meta charset="utf-8" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link type="text/css" rel="stylesheet" href="leaflet.css">
	<link type="text/css" rel="stylesheet" href="MarkerCluster.css">
	<link type="text/css" rel="stylesheet" href="MarkerCluster.Default.css">
	<link type="text/css" rel="stylesheet" href="leaflet.awesome-markers.css">
	<link type="text/css" rel="stylesheet" href="font-awesome/css/font-awesome.min.css">

	<script src="leaflet.js"></script>
	<script src="leaflet.markercluster.js"></script>
	<script src="leaflet.awesome-markers.min.js"></script>
	<script src="leaflet.ajax.min.js"></script>
	<script src="data.js"></script>
	<style>
		body { padding: 0; margin 0; }
		html, body, #mapid { height: 100%;, width: 100%; }
	</style>
</head>
<body>
	<div id="mapid"</div>
	<script>
		var deadmarker = L.AwesomeMarkers.icon({
					icon: 'close',
					prefix: 'fa',
					markerColor: 'red'
		});

		var redmarker = L.AwesomeMarkers.icon({
					markerColor: 'red'
		});

		var bluemarker = L.AwesomeMarkers.icon({
					markerColor: 'blue'
		});

		var orangemarker = L.AwesomeMarkers.icon({
					markerColor: 'orange'
		});



		var map=L.map('mapid').setView([51.902578, 8.385411], 12);

		L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			maxZoom: 18,
			attribution: 'Map data © <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
			id: 'basemap'
		}).addTo(map);

		var boundary = L.geoJson.ajax("boundary_guetersloh.geojson",
				{
					style: {
							"color": "#ff0080",
							"fillOpacity": 0
					}
				});
		map.addLayer(boundary);

		var markers = L.markerClusterGroup();

		for(var i in data) {
			var d=data[i];

			/* Create unfalltype */
			var typ=d.typ;
			var utyp=d.utyp;

			if (utyp < 10) {
					utyp="0" + utyp;
			}
			var type=typ + utyp;

			var t="Title " + type;

			var icon=bluemarker;
			if (d.gt != 0) {
				icon=deadmarker;
			} else if (d.sv != 0) {
				icon=redmarker;
			} else if (d.lv != 0) {
				icon=orangemarker;
			}

			var m=L.marker(new L.LatLng(data[i].geoy, data[i].geox),
					{ icon: icon, title: t });

			/* Create unfalltype image link */
			var timage="<img src=\"images/unka/" + type + ".png\">";

			var ort=d.strasse1;
			if (d.strasse2) {
					ort=ort + " / " + d.strasse2;
			}

			/* Create popup with HTML code */
			var p=d.tag + " " + d.datum + " " + d.zeit + "Uhr<br>"
					+ timage + "<br>"
					+ ort;

			if (d.gt != 0) {
				p=p + "<br>" + d.gt + " Getötete(r)";
			}
			if (d.sv != 0) {
				p=p + "<br>" + d.sv + " Schwerletzte(r)";
			}
			if (d.lv != 0) {
				p=p + "<br>" + d.lv + " Leichtverletzte(r)";
			}

			m.bindPopup(p)

			markers.addLayer(m);
		}
	
		map.addLayer(markers);
	</script>
</body>
</html>
